<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯Tokenè®¾ç½® - ç®€å†ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        .token-display {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
            font-size: 12px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .quick-action {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .quick-action h3 {
            color: #155724;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å‰ç«¯Tokenè®¾ç½®å·¥å…·</h1>
        
        <!-- å¿«é€Ÿè®¾ç½®åŒºåŸŸ -->
        <div class="quick-action">
            <h3>ğŸš€ å¿«é€Ÿè®¾ç½® - ä¸€é”®è§£å†³Tokené—®é¢˜</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è‡ªåŠ¨è®¾ç½®æœ€æ–°çš„æœ‰æ•ˆTokenï¼š</p>
            <button class="btn btn-success" onclick="setLatestToken()">ğŸ”‘ è®¾ç½®æœ€æ–°Token</button>
            <div id="quickStatus"></div>
        </div>

        <!-- Tokenç®¡ç†åŒºåŸŸ -->
        <div class="section">
            <h2>ğŸ”‘ Tokenç®¡ç†</h2>
            <p>å½“å‰æœ€æ–°æœ‰æ•ˆTokenï¼š</p>
            <div class="token-display" id="latestToken">
                eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsImlhdCI6MTc1MTQyNjM3NCwiZXhwIjoxNzUyMDMxMTc0fQ.FDNz29CVyGh0GqDoZ3kysaaEoCXGxqRa0GfcwVqTWSQ
            </div>
            
            <button class="btn" onclick="generateNewToken()">ğŸ”„ ç”Ÿæˆæ–°Token</button>
            <button class="btn btn-warning" onclick="copyToken()">ğŸ“‹ å¤åˆ¶Token</button>
            <button class="btn btn-success" onclick="setTokenToLocalStorage()">ğŸ’¾ è®¾ç½®åˆ°å‰ç«¯</button>
            
            <div id="tokenStatus"></div>
        </div>

        <!-- APIæµ‹è¯•åŒºåŸŸ -->
        <div class="section">
            <h2>ğŸ§ª APIæµ‹è¯•</h2>
            <p>æµ‹è¯•å„ç§APIæ¥å£æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
            
            <button class="btn" onclick="testResumeAPI()">ğŸ“„ æµ‹è¯•ç®€å†åˆ—è¡¨</button>
            <button class="btn" onclick="testJobAPI()">ğŸ’¼ æµ‹è¯•å²—ä½åˆ—è¡¨</button>
            <button class="btn" onclick="testCreateJob()">â• æµ‹è¯•åˆ›å»ºå²—ä½</button>
            <button class="btn" onclick="testAllAPIs()">ğŸ” å…¨é¢æµ‹è¯•</button>
            
            <div id="apiStatus"></div>
        </div>

        <!-- æ—¥å¿—åŒºåŸŸ -->
        <div class="section">
            <h2>ğŸ“‹ æ“ä½œæ—¥å¿—</h2>
            <div id="logArea" class="log">å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…æ“ä½œ...\n</div>
            <button class="btn btn-warning" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="section">
            <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
            <ol>
                <li><strong>å¿«é€Ÿè§£å†³é—®é¢˜</strong>ï¼šç‚¹å‡»"è®¾ç½®æœ€æ–°Token"æŒ‰é’®å³å¯è§£å†³æ‰€æœ‰è®¤è¯é—®é¢˜</li>
                <li><strong>æ‰‹åŠ¨è®¾ç½®</strong>ï¼šå¤åˆ¶ä¸Šé¢çš„Tokenï¼Œç„¶ååœ¨å‰ç«¯æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š
                    <div class="token-display">localStorage.setItem('token', 'YOUR_TOKEN_HERE');</div>
                </li>
                <li><strong>éªŒè¯è®¾ç½®</strong>ï¼šåˆ·æ–°å‰ç«¯é¡µé¢ï¼Œæ£€æŸ¥æ˜¯å¦è¿˜æœ‰Tokené”™è¯¯</li>
                <li><strong>æµ‹è¯•API</strong>ï¼šä½¿ç”¨APIæµ‹è¯•æŒ‰é’®éªŒè¯å„åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
            </ol>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsImlhdCI6MTc1MTQyNjM3NCwiZXhwIjoxNzUyMDMxMTc0fQ.FDNz29CVyGh0GqDoZ3kysaaEoCXGxqRa0GfcwVqTWSQ';

        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logArea').textContent = 'æ—¥å¿—å·²æ¸…ç©º\n';
        }

        function showStatus(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }

        async function generateNewToken() {
            try {
                log('æ­£åœ¨ç”Ÿæˆæ–°Token...');
                const response = await fetch(`${API_BASE}/generate-token`);
                const data = await response.json();
                
                if (data.success) {
                    currentToken = data.token;
                    document.getElementById('latestToken').textContent = currentToken;
                    showStatus('tokenStatus', 'âœ… æ–°Tokenç”ŸæˆæˆåŠŸï¼');
                    log(`æ–°Tokenç”ŸæˆæˆåŠŸ: ${currentToken.substring(0, 50)}...`);
                } else {
                    throw new Error(data.message || 'ç”ŸæˆTokenå¤±è´¥');
                }
            } catch (error) {
                showStatus('tokenStatus', `âŒ ç”ŸæˆTokenå¤±è´¥: ${error.message}`, false);
                log(`ç”ŸæˆTokenå¤±è´¥: ${error.message}`);
            }
        }

        function copyToken() {
            navigator.clipboard.writeText(currentToken).then(() => {
                showStatus('tokenStatus', 'âœ… Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                log('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(err => {
                showStatus('tokenStatus', 'âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', false);
                log(`å¤åˆ¶å¤±è´¥: ${err.message}`);
            });
        }

        function setTokenToLocalStorage() {
            try {
                // å°è¯•è®¾ç½®åˆ°å½“å‰é¡µé¢çš„localStorage
                localStorage.setItem('token', currentToken);
                showStatus('tokenStatus', 'âœ… Tokenå·²è®¾ç½®åˆ°å½“å‰é¡µé¢localStorageï¼');
                log('Tokenå·²è®¾ç½®åˆ°localStorage');
                
                // æä¾›å‰ç«¯è®¾ç½®æŒ‡ä»¤
                const instruction = `è¯·åœ¨å‰ç«¯é¡µé¢ï¼ˆhttp://localhost:3016ï¼‰çš„æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š\nlocalStorage.setItem('token', '${currentToken}');`;
                log(instruction);
            } catch (error) {
                showStatus('tokenStatus', `âŒ è®¾ç½®å¤±è´¥: ${error.message}`, false);
                log(`è®¾ç½®localStorageå¤±è´¥: ${error.message}`);
            }
        }

        function setLatestToken() {
            try {
                // è®¾ç½®åˆ°localStorage
                localStorage.setItem('token', currentToken);
                
                // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                showStatus('quickStatus', 'âœ… æœ€æ–°Tokenå·²è®¾ç½®æˆåŠŸï¼ç°åœ¨å¯ä»¥åˆ·æ–°å‰ç«¯é¡µé¢æµ‹è¯•åŠŸèƒ½ã€‚');
                log('å¿«é€Ÿè®¾ç½®å®Œæˆ - Tokenå·²æ›´æ–°');
                
                // è‡ªåŠ¨æµ‹è¯•API
                setTimeout(() => {
                    testAllAPIs();
                }, 1000);
                
            } catch (error) {
                showStatus('quickStatus', `âŒ è®¾ç½®å¤±è´¥: ${error.message}`, false);
                log(`å¿«é€Ÿè®¾ç½®å¤±è´¥: ${error.message}`);
            }
        }

        async function testAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                if (response.ok && result.success) {
                    return { success: true, data: result };
                } else {
                    throw new Error(result.message || `HTTP ${response.status}`);
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function testResumeAPI() {
            log('æµ‹è¯•ç®€å†åˆ—è¡¨API...');
            const result = await testAPI('/api/resumes');
            
            if (result.success) {
                const count = result.data.data?.length || 0;
                showStatus('apiStatus', `âœ… ç®€å†åˆ—è¡¨APIæ­£å¸¸ (${count}ä¸ªç®€å†)`);
                log(`ç®€å†åˆ—è¡¨APIæµ‹è¯•æˆåŠŸï¼Œæ‰¾åˆ°${count}ä¸ªç®€å†`);
            } else {
                showStatus('apiStatus', `âŒ ç®€å†åˆ—è¡¨APIå¤±è´¥: ${result.error}`, false);
                log(`ç®€å†åˆ—è¡¨APIæµ‹è¯•å¤±è´¥: ${result.error}`);
            }
        }

        async function testJobAPI() {
            log('æµ‹è¯•å²—ä½åˆ—è¡¨API...');
            const result = await testAPI('/api/jobs');
            
            if (result.success) {
                const count = result.data.data?.length || 0;
                showStatus('apiStatus', `âœ… å²—ä½åˆ—è¡¨APIæ­£å¸¸ (${count}ä¸ªå²—ä½)`);
                log(`å²—ä½åˆ—è¡¨APIæµ‹è¯•æˆåŠŸï¼Œæ‰¾åˆ°${count}ä¸ªå²—ä½`);
            } else {
                showStatus('apiStatus', `âŒ å²—ä½åˆ—è¡¨APIå¤±è´¥: ${result.error}`, false);
                log(`å²—ä½åˆ—è¡¨APIæµ‹è¯•å¤±è´¥: ${result.error}`);
            }
        }

        async function testCreateJob() {
            log('æµ‹è¯•åˆ›å»ºå²—ä½API...');
            const testJob = {
                title: 'æµ‹è¯•å²—ä½ - ' + new Date().toLocaleTimeString(),
                company: 'æµ‹è¯•å…¬å¸',
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å²—ä½æè¿°',
                requirements: 'æµ‹è¯•è¦æ±‚'
            };
            
            const result = await testAPI('/api/jobs', 'POST', testJob);
            
            if (result.success) {
                showStatus('apiStatus', 'âœ… åˆ›å»ºå²—ä½APIæ­£å¸¸');
                log(`åˆ›å»ºå²—ä½APIæµ‹è¯•æˆåŠŸï¼Œå²—ä½ID: ${result.data.data?.id}`);
            } else {
                showStatus('apiStatus', `âŒ åˆ›å»ºå²—ä½APIå¤±è´¥: ${result.error}`, false);
                log(`åˆ›å»ºå²—ä½APIæµ‹è¯•å¤±è´¥: ${result.error}`);
            }
        }

        async function testAllAPIs() {
            log('å¼€å§‹å…¨é¢APIæµ‹è¯•...');
            showStatus('apiStatus', 'ğŸ”„ æ­£åœ¨è¿›è¡Œå…¨é¢æµ‹è¯•...');
            
            const tests = [
                { name: 'ç®€å†åˆ—è¡¨', test: testResumeAPI },
                { name: 'å²—ä½åˆ—è¡¨', test: testJobAPI },
                { name: 'åˆ›å»ºå²—ä½', test: testCreateJob }
            ];
            
            let successCount = 0;
            
            for (const { name, test } of tests) {
                try {
                    await test();
                    successCount++;
                } catch (error) {
                    log(`${name}æµ‹è¯•å¼‚å¸¸: ${error.message}`);
                }
                
                // çŸ­æš‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const message = `âœ… å…¨é¢æµ‹è¯•å®Œæˆ: ${successCount}/${tests.length} ä¸ªAPIæ­£å¸¸`;
            showStatus('apiStatus', message);
            log(message);
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('Tokenè®¾ç½®å·¥å…·å·²å°±ç»ª');
            log(`å½“å‰Token: ${currentToken.substring(0, 50)}...`);
        };
    </script>
</body>
</html> 