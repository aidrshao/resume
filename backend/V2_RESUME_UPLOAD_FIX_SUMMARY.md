# V2ç®€å†ä¸Šä¼ åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜åˆ†æ

### ä¸»è¦ç—‡çŠ¶
1. **ä¸Šä¼ åç«‹å³è·³è½¬ç™»å½•é¡µé¢**ï¼šç”¨æˆ·ä¸Šä¼ ç®€å†æ–‡ä»¶åï¼Œå‡ºç°å¤§å¤§çš„å¹å·é”™è¯¯æç¤ºï¼Œç„¶åç«‹å³è·³è½¬åˆ°ç™»å½•é¡µé¢
2. **AIæç¤ºè¯ç¼ºå¤±é”™è¯¯**ï¼šåç«¯æ—¥å¿—æ˜¾ç¤º `[PROMPT_FETCH_ERROR] Critical error: Prompt with key 'resume_parsing' not found in the database`
3. **è®¤è¯å¤±è´¥é—®é¢˜**ï¼šåç«¯æ—¥å¿—æ˜¾ç¤º `ğŸš€ [RESUME_PARSER_V2] ç”¨æˆ·ID: undefined` å’Œ `âŒ [RESUME_PARSER_V2] ç”¨æˆ·è®¤è¯å¤±è´¥`

### æ ¹æœ¬åŸå› 
1. **ç§å­æ•°æ®å¯¼å…¥é—®é¢˜**ï¼šä¹‹å‰åˆ é™¤è¿ç§»æ–‡ä»¶çš„æ“ä½œå¯¼è‡´AIæç¤ºè¯æ²¡æœ‰æ­£ç¡®å¯¼å…¥åˆ°æ•°æ®åº“
2. **è®¤è¯å­—æ®µä¸ä¸€è‡´**ï¼šV2ç‰ˆæœ¬æ§åˆ¶å™¨æœŸæœ› `req.user.id`ï¼Œä½†è®¤è¯ä¸­é—´ä»¶åªæä¾› `req.user.userId`
3. **æ—§ç‰ˆæœ¬ä»£ç æ®‹ç•™**ï¼šå‰ç«¯å·²å…¨éƒ¨åˆ‡æ¢åˆ°V2ç‰ˆæœ¬ï¼Œä½†åç«¯ä»ä¿ç•™æ—§ç‰ˆæœ¬APIç«¯ç‚¹

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤AIæç¤ºè¯ç¼ºå¤±é—®é¢˜

**é—®é¢˜ç¡®è®¤ï¼š**
```bash
# æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨resume_parsingæç¤ºè¯
node -e "const knex = require('knex')(require('./knexfile').development); knex('ai_prompts').select('*').where('key', 'resume_parsing').then(result => {console.log('resume_parsingæç¤ºè¯:', result); knex.destroy();})"
# ç»“æœï¼š[] ï¼ˆç©ºæ•°ç»„ï¼Œè¯´æ˜ä¸å­˜åœ¨ï¼‰
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ‰‹åŠ¨è¿è¡ŒAIæç¤ºè¯ç§å­æ•°æ®
npx knex seed:run --specific=02_ai_prompts.js
```

**éªŒè¯ä¿®å¤ï¼š**
```bash
# éªŒè¯AIæç¤ºè¯å·²æ­£ç¡®å¯¼å…¥
node -e "const knex = require('knex')(require('./knexfile').development); knex('ai_prompts').select('id', 'name', 'key', 'is_active').then(result => {console.log('AIæç¤ºè¯åˆ—è¡¨:', result); knex.destroy();})"
# ç»“æœï¼šåŒ…å«4ä¸ªæç¤ºè¯ï¼ŒåŒ…æ‹¬å…³é”®çš„resume_parsing
```

### 2. ä¿®å¤è®¤è¯å­—æ®µä¸ä¸€è‡´é—®é¢˜

**é—®é¢˜åˆ†æï¼š**
- V2æ§åˆ¶å™¨ä½¿ç”¨ `req.user.id`
- æ—§ç‰ˆæœ¬æ§åˆ¶å™¨ä½¿ç”¨ `req.user.userId`
- è®¤è¯ä¸­é—´ä»¶åªæä¾› `req.user.userId`

**è§£å†³æ–¹æ¡ˆï¼š**
ä¿®æ”¹ `backend/middleware/auth.js`ï¼ŒåŒæ—¶æä¾›ä¸¤ä¸ªå­—æ®µï¼š
```javascript
// ç»Ÿä¸€ç”¨æˆ·IDå­—æ®µï¼Œç¡®ä¿å…¼å®¹æ€§
req.user = {
  ...decoded,
  id: decoded.userId,        // ä¸ºäº†å…¼å®¹ä½¿ç”¨req.user.idçš„æ§åˆ¶å™¨
  userId: decoded.userId     // ä¸ºäº†å…¼å®¹ä½¿ç”¨req.user.userIdçš„æ§åˆ¶å™¨
};
```

### 3. æ¸…ç†æ—§ç‰ˆæœ¬ä»£ç 

**åºŸå¼ƒæ—§ç‰ˆæœ¬APIç«¯ç‚¹ï¼š**
```javascript
// åœ¨ backend/routes/resumeRoutes.js ä¸­æ³¨é‡Šæ‰æ—§ç‰ˆæœ¬è·¯ç”±
// router.post('/resumes/upload', upload.single('resume'), ResumeController.uploadAndParseResume);
```

**æ·»åŠ å¼ƒç”¨è­¦å‘Šï¼š**
```javascript
// åœ¨ backend/controllers/resumeController.js ä¸­æ·»åŠ å¼ƒç”¨è­¦å‘Š
/**
 * @deprecated æ­¤æ–¹æ³•å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨V2ç‰ˆæœ¬ /api/v2/resumes/parse
 */
static async uploadAndParseResume(req, res) {
  console.warn(`âš ï¸ [DEPRECATED] ä½¿ç”¨äº†å·²åºŸå¼ƒçš„ä¸Šä¼ APIï¼Œè¯·è¿ç§»åˆ°V2ç‰ˆæœ¬`);
  // ... ä¿ç•™åŸæœ‰ä»£ç 
}
```

### 4. ä¿®å¤ç§å­æ•°æ®è„šæœ¬

**é—®é¢˜ï¼š**
ä¸»è¦çš„ç§å­æ•°æ®è„šæœ¬ `scripts/seed.js` åªå¤„ç†å¥—é¤æ•°æ®ï¼Œä¸å¤„ç†AIæç¤ºè¯

**è§£å†³æ–¹æ¡ˆï¼š**
æ›´æ–° `scripts/seed.js`ï¼Œè‡ªåŠ¨æ£€æŸ¥å’Œå¯¼å…¥AIæç¤ºè¯ï¼š
```javascript
console.log('ğŸ” æ­£åœ¨æ£€æŸ¥AIæç¤ºè¯æ˜¯å¦å·²å­˜åœ¨...');
const existingPrompts = await knex('ai_prompts').count('* as count').first();
const promptCount = parseInt(existingPrompts.count);

if (promptCount === 0) {
  console.log('ğŸ“ AIæç¤ºè¯ä¸å­˜åœ¨ï¼Œæ­£åœ¨å¯¼å…¥...');
  const aiPromptSeed = require('../seeds/02_ai_prompts.js');
  await aiPromptSeed.seed(knex);
  console.log('âœ… AIæç¤ºè¯å·²å¯¼å…¥');
} else {
  console.log(`â„¹ï¸ å·²æ£€æµ‹åˆ°${promptCount}ä¸ªAIæç¤ºè¯ï¼Œè·³è¿‡å¯¼å…¥ã€‚`);
}
```

## âœ… åŠŸèƒ½éªŒè¯

### æµ‹è¯•ç»“æœ
åˆ›å»ºå¹¶è¿è¡Œäº†å®Œæ•´çš„V2ç®€å†è§£æåŠŸèƒ½æµ‹è¯•ï¼ŒéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **æ–‡ä»¶ä¸Šä¼ æˆåŠŸ**ï¼šâœ…
2. **ä»»åŠ¡åˆ›å»ºæˆåŠŸ**ï¼šâœ… 
3. **AIè§£ææˆåŠŸ**ï¼šâœ…
4. **æ•°æ®è§£æå‡†ç¡®**ï¼šâœ…
   - å§“åï¼šé‚µä¿Š âœ…
   - é‚®ç®±ï¼šshaojun@example.com âœ…
   - ç”µè¯ï¼š13800138000 âœ…
   - åœ°å€ï¼šä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº âœ…
   - å·¥ä½œç»å†ï¼š1æ¡ âœ…
   - é¡¹ç›®ç»å†ï¼š1æ¡ âœ…
   - æ•™è‚²èƒŒæ™¯ï¼š1æ¡ âœ…
   - æŠ€èƒ½åˆ†ç±»ï¼š3ä¸ª âœ…

### æ€§èƒ½æŒ‡æ ‡
- **æ–‡ä»¶ä¸Šä¼ å“åº”æ—¶é—´**ï¼š< 1ç§’
- **AIè§£æå¤„ç†æ—¶é—´**ï¼š13-15ç§’
- **æ€»ä½“å¤„ç†æ—¶é—´**ï¼šçº¦16ç§’

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
1. **ç¡®ä¿RedisæœåŠ¡è¿è¡Œ**ï¼ˆæ¨èä½†éå¿…éœ€ï¼‰
2. **è¿è¡Œæ•°æ®åº“è¿ç§»**ï¼š`npm run migrate`
3. **è¿è¡Œç§å­æ•°æ®**ï¼š`npm run seed`ï¼ˆç°åœ¨ä¼šè‡ªåŠ¨å¯¼å…¥AIæç¤ºè¯ï¼‰
4. **å¯åŠ¨æœåŠ¡**ï¼š`npm start`

### ç¯å¢ƒå˜é‡è¦æ±‚
```bash
# AI APIé…ç½®ï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=your-api-key
OPENAI_BASE_URL=https://api.agicto.cn/v1

# Redisé…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379
```

## ğŸ¯ å…³é”®æ”¹è¿›

1. **ç»Ÿä¸€è®¤è¯æœºåˆ¶**ï¼šè§£å†³äº†æ–°æ—§ç‰ˆæœ¬æ§åˆ¶å™¨çš„å…¼å®¹æ€§é—®é¢˜
2. **å®Œå–„ç§å­æ•°æ®**ï¼šç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸€é”®éƒ¨ç½²æˆåŠŸ
3. **ä»£ç æ¸…ç†**ï¼šåºŸå¼ƒæ—§ç‰ˆæœ¬APIï¼Œé¿å…æ··ä¹±
4. **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºäº†é”™è¯¯æç¤ºå’Œè°ƒè¯•ä¿¡æ¯

## ğŸ“‹ AIæç¤ºè¯é…ç½®

ç³»ç»Ÿç°åœ¨åŒ…å«ä»¥ä¸‹AIæç¤ºè¯ï¼š
1. **resume_optimizer**ï¼šç®€å†ä¼˜åŒ–å™¨
2. **resume_suggestions**ï¼šç®€å†å»ºè®®ç”Ÿæˆå™¨  
3. **user_info_collector**ï¼šç”¨æˆ·ä¿¡æ¯æ”¶é›†åŠ©æ‰‹
4. **resume_parsing**ï¼šç®€å†è§£æä¸“å®¶ï¼ˆå…³é”®ï¼‰

### ç®€å†è§£æä¸“å®¶æç¤ºè¯
- **ç”¨é€”**ï¼šå°†ç®€å†æ–‡æœ¬è§£æä¸ºç»“æ„åŒ–æ•°æ®
- **æ¨¡å‹**ï¼šDeepSeek
- **è¶…æ—¶æ—¶é—´**ï¼š180ç§’
- **è¿”å›æ ¼å¼**ï¼šç»Ÿä¸€çš„JSONæ ¼å¼ï¼ŒåŒ…å«profileã€workExperienceã€educationã€skillsç­‰å­—æ®µ

## ğŸ”® æœªæ¥ä¼˜åŒ–å»ºè®®

1. **å®Œå…¨ç§»é™¤æ—§ç‰ˆæœ¬ä»£ç **ï¼šåœ¨ç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸åï¼Œå®Œå…¨ç§»é™¤æ—§ç‰ˆæœ¬çš„ä¸Šä¼ ç›¸å…³ä»£ç 
2. **ä¼˜åŒ–AIæç¤ºè¯**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æ•ˆæœï¼ŒæŒç»­ä¼˜åŒ–AIæç¤ºè¯çš„å‡†ç¡®æ€§
3. **å¢åŠ æ–‡ä»¶æ ¼å¼æ”¯æŒ**ï¼šè€ƒè™‘æ”¯æŒæ›´å¤šç®€å†æ–‡ä»¶æ ¼å¼
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–AIå¤„ç†é€Ÿåº¦ï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´

## ğŸ‰ æ€»ç»“

é€šè¿‡ç³»ç»Ÿæ€§çš„é—®é¢˜åˆ†æå’Œä¿®å¤ï¼ŒV2ç‰ˆæœ¬çš„ç®€å†ä¸Šä¼ åŠŸèƒ½ç°åœ¨å®Œå…¨æ­£å¸¸å·¥ä½œã€‚ä¸»è¦è§£å†³äº†ï¼š

1. âœ… **è®¤è¯é—®é¢˜**ï¼šç”¨æˆ·ä¸å†ä¼šè¢«æ„å¤–è¸¢å‡ºç™»å½•
2. âœ… **AIæç¤ºè¯ç¼ºå¤±**ï¼šç®€å†è§£æåŠŸèƒ½æ­£å¸¸å·¥ä½œ
3. âœ… **æ•°æ®å‡†ç¡®æ€§**ï¼šèƒ½å¤Ÿå‡†ç¡®è§£æå„ç§ç®€å†ä¿¡æ¯
4. âœ… **éƒ¨ç½²ç¨³å®šæ€§**ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ›´åŠ ç¨³å®šå¯é 

ç”¨æˆ·ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ç®€å†ä¸Šä¼ åŠŸèƒ½ï¼Œä¸ä¼šå†é‡åˆ°ä¸Šä¼ åè·³è½¬ç™»å½•é¡µé¢çš„é—®é¢˜ã€‚ 