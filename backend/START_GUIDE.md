# ğŸš€ Resume Backend å¯åŠ¨ä¸ç›‘æ§æŒ‡å—

## å¿«é€Ÿå¯åŠ¨

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# 1. ä¼ ç»Ÿæ–¹å¼å¯åŠ¨ï¼ˆé€‚åˆå¼€å‘è°ƒè¯•ï¼‰
npm start

# 2. è‡ªåŠ¨é‡è½½å¯åŠ¨ï¼ˆå¼€å‘æ—¶æ¨èï¼‰
npm run dev

# 3. PM2ç®¡ç†å¯åŠ¨ï¼ˆç”Ÿäº§çº§åˆ«ï¼‰
npm run start:dev
```

### ç”Ÿäº§ç¯å¢ƒå¯åŠ¨

```bash
# ä½¿ç”¨PM2å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
npm run start:prod

# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
npm run startup
npm run save
```

## ğŸ”§ PM2 ç®¡ç†å‘½ä»¤

### åŸºæœ¬æ“ä½œ

```bash
# æŸ¥çœ‹çŠ¶æ€
npm run status

# æŸ¥çœ‹æ—¥å¿—
npm run logs

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
npm run logs:error

# æŸ¥çœ‹è¾“å‡ºæ—¥å¿—
npm run logs:out

# é‡å¯æœåŠ¡
npm run restart

# é‡è½½æœåŠ¡ï¼ˆé›¶åœæœºï¼‰
npm run reload

# åœæ­¢æœåŠ¡
npm run stop

# åˆ é™¤æœåŠ¡
npm run delete
```

### ç›‘æ§å’Œè°ƒè¯•

```bash
# å®æ—¶ç›‘æ§
npm run monit

# å¥åº·æ£€æŸ¥ï¼ˆå•æ¬¡ï¼‰
npm run health

# æŒç»­å¥åº·ç›‘æ§
npm run health:monitor
```

## ğŸ“Š å¥åº·æ£€æŸ¥ç³»ç»Ÿ

### è‡ªåŠ¨ç›‘æ§åŠŸèƒ½

- **æ£€æŸ¥é—´éš”**: 30ç§’
- **å¤±è´¥é˜ˆå€¼**: è¿ç»­3æ¬¡å¤±è´¥è§¦å‘æ¢å¤
- **ç›‘æ§ç«¯ç‚¹**:
  - `/api/health` - åŸºç¡€å¥åº·æ£€æŸ¥
  - `/api/v2/tasks/test/status` - APIåŠŸèƒ½æ£€æŸ¥

### è‡ªåŠ¨æ¢å¤æœºåˆ¶

1. **æ£€æµ‹æœåŠ¡å¼‚å¸¸** - è¿ç»­å¤±è´¥è¶…è¿‡é˜ˆå€¼
2. **å°è¯•PM2é‡å¯** - ä¼˜å…ˆä½¿ç”¨PM2ç®¡ç†
3. **ç›´æ¥è¿›ç¨‹å¯åŠ¨** - PM2å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
4. **éªŒè¯æ¢å¤** - è‡ªåŠ¨é‡æ–°æ£€æŸ¥æœåŠ¡çŠ¶æ€

### æ‰‹åŠ¨å¥åº·æ£€æŸ¥

```bash
# æ‰§è¡Œå•æ¬¡å¥åº·æ£€æŸ¥
npm run health

# å¯åŠ¨æŒç»­ç›‘æ§ï¼ˆæ¨èåœ¨ç”Ÿäº§ç¯å¢ƒåå°è¿è¡Œï¼‰
npm run health:monitor &
```

## ğŸ—‚ï¸ æ—¥å¿—ç®¡ç†

### æ—¥å¿—æ–‡ä»¶ä½ç½®

```
backend/logs/
â”œâ”€â”€ pm2-combined.log    # åˆå¹¶æ—¥å¿—
â”œâ”€â”€ pm2-out.log        # æ ‡å‡†è¾“å‡ºæ—¥å¿—
â”œâ”€â”€ pm2-error.log      # é”™è¯¯æ—¥å¿—
â””â”€â”€ pm2.pid           # è¿›ç¨‹IDæ–‡ä»¶
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
npm run logs

# åªæŸ¥çœ‹é”™è¯¯æ—¥å¿—
npm run logs:error

# ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f logs/pm2-combined.log
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
   ```bash
   # æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   lsof -i :8000
   
   # æ€æ­»å ç”¨è¿›ç¨‹
   kill -9 <PID>
   ```

2. **PM2æœåŠ¡æœªå¯åŠ¨**
   ```bash
   # é‡æ–°å¯åŠ¨PM2æœåŠ¡
   npm run start:dev
   ```

3. **å¥åº·æ£€æŸ¥å¤±è´¥**
   ```bash
   # æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€
   curl http://localhost:8000/api/health
   
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
   npm run logs:error
   ```

4. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒå˜é‡
   cat .env
   
   # æµ‹è¯•æ•°æ®åº“è¿æ¥
   npm run migrate:status
   ```

### ç´§æ€¥æ¢å¤æ­¥éª¤

å¦‚æœæœåŠ¡å®Œå…¨æ— å“åº”ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
npm run stop
pm2 delete all

# 2. æ¸…ç†ç«¯å£
lsof -ti:8000 | xargs kill -9

# 3. é‡æ–°å¯åŠ¨
npm run start:dev

# 4. éªŒè¯æœåŠ¡
npm run health
```

## ğŸ“‹ æœ€ä½³å®è·µ

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ä½¿ç”¨PM2ç®¡ç†**
   ```bash
   npm run start:prod
   npm run save
   ```

2. **è®¾ç½®å¼€æœºè‡ªå¯**
   ```bash
   npm run startup
   # æŒ‰æç¤ºæ‰§è¡Œæ˜¾ç¤ºçš„å‘½ä»¤
   ```

3. **å¯ç”¨å¥åº·ç›‘æ§**
   ```bash
   # åœ¨åå°è¿è¡Œå¥åº·ç›‘æ§
   nohup npm run health:monitor > /dev/null 2>&1 &
   ```

4. **å®šæœŸå¤‡ä»½é…ç½®**
   ```bash
   npm run save  # ä¿å­˜PM2é…ç½®
   ```

### ç›‘æ§å»ºè®®

- ç”Ÿäº§ç¯å¢ƒå»ºè®®è¿è¡Œ `npm run health:monitor` è¿›è¡ŒæŒç»­ç›‘æ§
- å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œå¿…è¦æ—¶è¿›è¡Œæ—¥å¿—è½®è½¬
- ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼ˆå†…å­˜ã€CPUï¼‰
- è®¾ç½®å‘Šè­¦æœºåˆ¶ï¼Œåœ¨æœåŠ¡å¼‚å¸¸æ—¶åŠæ—¶é€šçŸ¥

### æ€§èƒ½ä¼˜åŒ–

- æ ¹æ®è´Ÿè½½è°ƒæ•´ `max_memory_restart` è®¾ç½®
- ç›‘æ§é‡å¯æ¬¡æ•°ï¼Œé¢‘ç¹é‡å¯å¯èƒ½è¡¨æ˜å­˜åœ¨å†…å­˜æ³„æ¼
- ä½¿ç”¨ `npm run monit` å®æ—¶æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡

## ğŸ”— ç›¸å…³èµ„æº

- [PM2 å®˜æ–¹æ–‡æ¡£](https://pm2.keymetrics.io/)
- [Node.js æœ€ä½³å®è·µ](https://github.com/goldbergyoni/nodebestpractices)
- [å¥åº·æ£€æŸ¥è„šæœ¬æºç ](./scripts/health-check.js)
- [PM2 é…ç½®æ–‡ä»¶](./ecosystem.config.js)

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥ï¼š

1. æŸ¥çœ‹å¥åº·æ£€æŸ¥ç»“æœï¼š`npm run health`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`npm run status`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`npm run logs:error`
4. æŒ‰ç…§æ•…éšœæ’é™¤æ­¥éª¤æ“ä½œ
5. å¦‚ä»æ— æ³•è§£å†³ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå¹¶æä¾›æ—¥å¿—ä¿¡æ¯ 