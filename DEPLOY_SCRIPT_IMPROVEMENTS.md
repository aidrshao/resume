# éƒ¨ç½²è„šæœ¬æ”¹è¿›æ€»ç»“

## ğŸ”§ ä¸»è¦æ”¹è¿›å†…å®¹

### 1. ä¿®å¤æ•°æ®åº“è¿ç§»æ–‡ä»¶
- **æ–‡ä»¶**: `backend/migrations/20250703000001_unified_schema_migration.js`
- **é—®é¢˜**: å°è¯•åˆ é™¤ä¸å­˜åœ¨çš„å­—æ®µå¯¼è‡´è¿ç§»å¤±è´¥
- **è§£å†³**: æ­£ç¡®å¤„ç†å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥ï¼Œä½¿ç”¨Promise.all()å¹¶è¡Œå¤„ç†åˆ é™¤æ“ä½œ

### 2. å¢å¼ºæ•°æ®åº“è¿ç§»é”™è¯¯å¤„ç†
- **ä½ç½®**: `deploy.sh` ä¸­çš„ `setup_backend` å‡½æ•°
- **æ”¹è¿›**: 
  - æ·»åŠ 3æ¬¡é‡è¯•æœºåˆ¶
  - ç¬¬1æ¬¡å¤±è´¥ï¼šæ¸…ç†è¿ç§»é”å®šæ–‡ä»¶å¹¶é‡è¯•
  - ç¬¬2æ¬¡å¤±è´¥ï¼šæ‰‹åŠ¨ä¿®å¤æ•°æ®åº“ç»“æ„
  - ç¬¬3æ¬¡å¤±è´¥ï¼šåˆ›å»ºåŸºæœ¬è¡¨ç»“æ„ç¡®ä¿ç³»ç»Ÿå¯è¿è¡Œ

### 3. å¢åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- **ä½ç½®**: `run_database_migration` å‡½æ•°
- **æ”¹è¿›**: 
  - æ•è·å¹¶æ˜¾ç¤ºå®Œæ•´çš„è¿ç§»é”™è¯¯ä¿¡æ¯
  - è¯†åˆ«ç‰¹å®šé”™è¯¯ç±»å‹å¹¶ç»™å‡ºç›¸åº”è­¦å‘Š
  - è®°å½•æ‰€æœ‰é”™è¯¯åˆ°æ—¥å¿—æ–‡ä»¶

### 4. æ·»åŠ æ•°æ®åº“çŠ¶æ€æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
- **æ–°å¢å‡½æ•°**: `check_and_repair_database_state`
- **åŠŸèƒ½**: 
  - æ£€æŸ¥å…³é”®è¡¨æ˜¯å¦å­˜åœ¨
  - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„è¡¨
  - å¤„ç†æ—§å­—æ®µè¿ç§»é—®é¢˜
  - ç¡®ä¿æ•°æ®åº“ç»“æ„å®Œæ•´æ€§

### 5. æ·»åŠ éƒ¨ç½²æ•…éšœæ’é™¤æŒ‡å—
- **æ–°å¢å‡½æ•°**: `show_deployment_troubleshooting`
- **åŠŸèƒ½**: 
  - åœ¨éƒ¨ç½²å¤±è´¥æ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ•…éšœæ’é™¤æ­¥éª¤
  - æä¾›å¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤
  - ç»™å‡ºé‡æ–°éƒ¨ç½²çš„å»ºè®®

### 6. æ”¹è¿›æˆåŠŸéƒ¨ç½²åçš„ä¿¡æ¯æ˜¾ç¤º
- **æ–°å¢å‡½æ•°**: `show_deployment_success_info`
- **åŠŸèƒ½**: 
  - æ•´ç†è®¿é—®åœ°å€ã€æœåŠ¡çŠ¶æ€ã€ç®¡ç†å‘½ä»¤ç­‰ä¿¡æ¯
  - æä¾›æµ‹è¯•è´¦å·å’Œé‡è¦æ–‡ä»¶è·¯å¾„
  - æ˜¾ç¤ºéƒ¨ç½²æˆåŠŸåçš„å®Œæ•´ä¿¡æ¯

## ğŸš€ éƒ¨ç½²ä½¿ç”¨è¯´æ˜

### æ­£å¸¸éƒ¨ç½²
```bash
sudo bash deploy.sh
```

### å¿«é€Ÿéƒ¨ç½²
```bash
sudo bash deploy.sh --mode=quick
```

### ä¿®å¤æ¨¡å¼
```bash
sudo bash deploy.sh --mode=fix
```

### æ¸…ç†é‡æ–°éƒ¨ç½²
```bash
sudo bash deploy.sh --mode=cleanup
sudo bash deploy.sh
```

## ğŸ” æ•…éšœæ’é™¤

### æ•°æ®åº“è¿ç§»å¤±è´¥
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š
   ```bash
   docker exec resume-postgres psql -U resume_user -d resume_db -c 'SELECT version();'
   ```

2. æ£€æŸ¥è¿ç§»çŠ¶æ€ï¼š
   ```bash
   cd /home/ubuntu/resume/backend && npm run migrate:status
   ```

3. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—ï¼š
   ```bash
   docker logs resume-postgres --tail 50
   ```

4. æ‰‹åŠ¨é‡ç½®è¿ç§»ï¼š
   ```bash
   cd /home/ubuntu/resume/backend && npm run migrate:rollback
   cd /home/ubuntu/resume/backend && npm run migrate:latest
   ```

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
- æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ï¼š`pm2 list`
- æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`pm2 logs resume-backend`
- æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€ï¼š`docker ps | grep postgres`

## ğŸ“‹ æµ‹è¯•è´¦å·

- **é‚®ç®±**: test@juncaishe.com
- **å¯†ç **: test123456

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

1. **æé«˜éƒ¨ç½²æˆåŠŸç‡**ï¼šé€šè¿‡å¤šé‡é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨ä¿®å¤æœºåˆ¶
2. **æ›´å¥½çš„é”™è¯¯è¯Šæ–­**ï¼šè¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œæ•…éšœæ’é™¤æŒ‡å—
3. **ç®€åŒ–é—®é¢˜è§£å†³**ï¼šè‡ªåŠ¨åŒ–çš„æ•°æ®åº“ç»“æ„ä¿®å¤
4. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**ï¼šæ¸…æ™°çš„æˆåŠŸä¿¡æ¯å’Œæ•…éšœæ’é™¤æ­¥éª¤

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **æ›´æ–°æ—¥æœŸ**: 2025-01-07
- **ç‰ˆæœ¬**: v1.5.1
- **ä¸»è¦æ”¹è¿›**: æ•°æ®åº“è¿ç§»é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨ä¿®å¤æœºåˆ¶

---

*å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—æ–‡ä»¶ï¼š`/var/log/resume-deploy.log`* 